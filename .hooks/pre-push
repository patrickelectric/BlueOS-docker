#!/bin/sh

set -e

echo "Running pre push hook!"
repository_path=$(git rev-parse --show-toplevel)

echo "Running shellcheck..."
#SC2005: Allow us to break line while running command
#SC2015: Allow us to use short circuit
#SC2046: Allow word splitting
#SC2086: Allow word splitting
git ls-files '*.sh' | xargs --max-lines=1 shellcheck --exclude=SC2005,SC2015,SC2046,SC2086

echo "Running eslint.."
git ls-files '*.js' '*.html' | xargs --max-lines=1 eslint

echo "Running isort.."
# Run isort for each python project
dirname $(git ls-files "$repository_path/*/setup.py") | xargs -I {} isort --src-path="{}" --check-only "{}" --profile black

echo "Running black.."
black --check --line-length=120 "$repository_path"

echo "Running pylint.."
pylint $(git ls-files '*.py')

echo "Running mypy.."
git ls-files '*.py' | xargs --max-lines=1 mypy --ignore-missing-imports --warn-unreachable --allow-untyped-decorators --strict

echo "Running pytest.."
pytest --cov="$repository_path" --cov-config="$repository_path/.coveragerc" --cov-report html --cov-report term

exit 0
